{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Web Fetcher Routing Configuration Schema",
  "description": "Schema for validating routing.yaml configuration",
  "type": "object",
  "required": ["version", "global", "rules"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Configuration version (e.g., 1.0)"
    },
    "global": {
      "type": "object",
      "required": ["default_fetcher"],
      "properties": {
        "default_fetcher": {
          "type": "string",
          "enum": ["urllib", "selenium", "manual_chrome"],
          "description": "Default fetcher when no rule matches"
        },
        "cache_ttl": {
          "type": "integer",
          "minimum": 0,
          "description": "Cache time-to-live in seconds"
        },
        "enable_logging": {
          "type": "boolean",
          "description": "Enable routing decision logging"
        }
      }
    },
    "rules": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name", "priority", "enabled", "conditions", "action"],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1,
            "description": "Rule name (English)"
          },
          "name_zh": {
            "type": "string",
            "description": "Rule name (Chinese)"
          },
          "priority": {
            "type": "integer",
            "minimum": 1,
            "maximum": 1000,
            "description": "Rule priority (higher = evaluated first)"
          },
          "enabled": {
            "type": "boolean",
            "description": "Whether rule is active"
          },
          "conditions": {
            "type": "object",
            "minProperties": 1,
            "properties": {
              "domain": {
                "type": "string",
                "description": "Exact domain match"
              },
              "domain_list": {
                "type": "array",
                "items": {"type": "string"},
                "description": "List of domains to match"
              },
              "url_pattern": {
                "type": "string",
                "description": "Regex pattern for URL matching"
              },
              "always": {
                "type": "boolean",
                "description": "Always match (for default rules)"
              }
            }
          },
          "action": {
            "type": "object",
            "required": ["fetcher"],
            "properties": {
              "fetcher": {
                "type": "string",
                "enum": ["urllib", "selenium", "manual_chrome"],
                "description": "Which fetcher to use"
              },
              "config": {
                "type": "object",
                "description": "Fetcher-specific configuration"
              },
              "reason": {
                "type": "string",
                "description": "Explanation for this routing choice (English)"
              },
              "reason_zh": {
                "type": "string",
                "description": "Explanation for this routing choice (Chinese)"
              }
            }
          }
        }
      }
    }
  }
}
